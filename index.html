<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½‰ç›¤æ‰“æ€ªå°éŠæˆ²</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            color: white;
            background: url('images/background.jpg') no-repeat center center fixed;
            background-size: cover;
        }
        
		    #selectionGif {
                          text-align: center;
                          margin-bottom: 20px;
                          }

            #selectionGif img {
                          width: 300px; /* å¯æ ¹æ“šéœ€æ±‚èª¿æ•´å¤§å° */
                          height: auto;
                          border-radius: 10px;
                              }

        .monster { 
            margin: 10px; padding: 10px; border: 2px solid white; cursor: pointer; display: inline-block; 
            background: rgba(0, 0, 0, 0.5); 
        }

        .spin-result {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 24px;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 20px;
            position: relative;
            min-width: 150px;
        }

        #gameArea, #lootArea { display: none; }

        img { width: 200px; display: block; margin: 0 auto; }

        .health-bar-container {
            width: 300px;
            background-color: #333;
            border-radius: 10px;
            margin: 10px auto;
            overflow: hidden;
            border: 2px solid white;
        }

        .health-bar {
            height: 20px;
            background-color: red;
            transition: width 0.5s ease-in-out;
        }

        #damageTaken {
            display: block;
            margin-top: 10px;
            font-size: 20px;
            color: yellow;
        }

        .damage-input-container {
            margin-top: 20px;
        }
		#skillButton {
                     font-size: 24px;
                     padding: 15px 30px;
                     margin-top: 20px;
                     background-color: orangered;
                     color: white;
                     border: none;
                     border-radius: 10px;
                     cursor: pointer;
                     display: block;
                     width: 80%;
                     max-width: 400px;
                     margin: 20px auto;
                     }

        #skillButton:active {
                     background-color: darkred;
                            }
	#attackButton {

    width: 100px; /* èª¿æ•´å¤§å° */
    height: auto;
    cursor: pointer; /* è®“æ»‘é¼ è®Šæˆé»æ“Šæ‰‹å‹¢ */
    transition: transform 0.1s ease-in-out;
}

#attackButton:active {
    transform: scale(0.9); /* é»æ“Šæ™‚ç¸®å°ä¸€é»ï¼Œå¢åŠ æ‰“æ“Šæ„Ÿ */
}

#spinButton {
    width: 120px; /* èª¿æ•´å¤§å° */
    height: auto;
    cursor: pointer; /* è®“æ»‘é¼ è®Šæˆé»æ“Šæ‰‹å‹¢ */
    transition: transform 0.1s ease-in-out;
}

#spinButton:active {
    transform: scale(0.9); /* é»æ“Šæ™‚ç¸®å°ä¸€é»ï¼Œå¢åŠ æ‰‹æ„Ÿ */
}

.icon {
    width: 30px;  /* èª¿æ•´å¤§å° */
    height: auto;
    vertical-align: middle;  /* è®“åœ–ç‰‡è·Ÿæ–‡å­—å°é½Š */
}

.spin-result {
    width: 200px; /* å›ºå®šå¤§å° */
    height: 50px; /* å›ºå®šé«˜åº¦ */
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 8px;
    font-size: 24px;
    font-weight: bold;
    color: white;
}

.spin-result img {
    max-width: 40px; /* é™åˆ¶åœ–ç‰‡å¤§å° */
    max-height: 40px;
    vertical-align: middle; /* åœ–ç‰‡å‚ç›´ç½®ä¸­ */
}
.spin-container {
    display: flex;
    align-items: center;  /* å‚ç›´ç½®ä¸­ */
    justify-content: center; /* æ°´å¹³ç½®ä¸­ */
    gap: 20px; /* æ§åˆ¶é–“è· */
    margin-top: 20px;

     width: fit-content; /* è®“å®¹å™¨å¯¬åº¦å‰›å¥½é©æ‡‰å…§å®¹ */
    margin: 0 auto; /* è®“å®ƒæ°´å¹³ç½®ä¸­ */
}
#spinButton img {
    width: 80px;  /* æŒ‰éˆ•åœ–ç‰‡å¤§å° */
    height: auto;
    cursor: pointer;
}

.monster-container {
    width: 250px;  /* å›ºå®šæ€ªç‰©é¡¯ç¤ºæ¡†çš„å¯¬åº¦ */
    height: 250px; /* å›ºå®šé«˜åº¦ï¼Œç¢ºä¿åœ–ç‰‡ä¸å½±éŸ¿ç‰ˆé¢ */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* é¿å…æº¢å‡º */
    margin: 0 auto; /* è®“å®ƒç½®ä¸­ */
}

#monsterImage {
    width: 200px; /* è¨­å®šå›ºå®šå¯¬åº¦ */
    height: 200px; /* è¨­å®šå›ºå®šé«˜åº¦ï¼Œç¢ºä¿ä¸è®Šå½¢ */
    object-fit: contain; /* ç¢ºä¿åœ–ç‰‡å®Œæ•´é¡¯ç¤ºï¼Œä¸æ‹‰ä¼¸è®Šå½¢ */
	z-index: 10; /* æ¯”å‚·å®³æ•¸å­—ä½ */
}

#damageTaken {
    display: inline-block;
    width: 100px;  /* å›ºå®šå¯¬åº¦ï¼Œæ ¹æ“šæœ€å¤§å‚·å®³æ•¸å­—èª¿æ•´ */
    text-align: center; /* ç¢ºä¿æ•¸å­—å±…ä¸­ */
    font-size: 20px;
    color: yellow;
}

#damageContainer {
    position: relative;
    width: 100%;
    height: 0;
	z-index: 1000; /* å¿…é ˆé«˜æ–¼æ€ªç‰© */
}

.damage-number {
    position: absolute;
    font-size: 28px;
    font-weight: bold;
    color: yellow;
    opacity: 1;
    transform: scale(1);
    transition: transform 1s ease-out, opacity 1s ease-out;
    white-space: nowrap;
    pointer-events: none;
	z-index: 9999; /* æé«˜å±¤ç´š */
}

.damage-number.animate {
    opacity: 1;
    transform: scale(1.5);
    top: -30px;  /* è®“æ•¸å­—å¾€ä¸Šç§»å‹• */
}

    </style>
</head>
<body>
    <h1>é¸æ“‡æ€ªç‰©</h1>
	
	 <!-- åŠ å…¥ GIF å‹•ç•« -->
    <div id="selectionGif">
        <img src="images/selection.gif" alt="é¸æ“‡æ€ªç‰©å‹•ç•«">
    </div>
	
    <div id="monsterSelection">
        <div class="monster" data-hp="50" data-img="images/monster1.png" data-dead="images/monster1_dead.png" data-drop="gold.png">æ€ªç‰©A (50HP)</div>
        <div class="monster" data-hp="100" data-img="images/monster2.png" data-dead="images/monster2_dead.png" data-drop="gem.png">æ€ªç‰©B (100HP)</div>
        <div class="monster" data-hp="150" data-img="images/monster3.png" data-dead="images/monster3_dead.png" data-drop="sword.png">æ€ªç‰©C (150HP)</div>
        <div class="monster" data-hp="200" data-img="images/monster4.png" data-dead="images/monster4_dead.png" data-drop="helmet.png">æ€ªç‰©D (200HP)</div>
    </div>

    <div id="gameArea">

        <h2>æ€ªç‰©è¡€é‡: <span id="monsterHp"></span></h2>
        <div class="health-bar-container">
            <div id="healthBar" class="health-bar"></div>
        </div>
	<div id="damageContainer" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div>
	
	<div id="monsterContainer" style="position: relative; display: inline-block;">
    <img id="monsterImage" src="monster_alive.png">
   
</div>
        <p id="damageTaken"></p>
		<div class="spin-container">
		
              <div id="spinResult" class="spin-result"></div>
			  
		<!-- è½‰ç›¤æŒ‰éˆ• --> 
        <img src="images/spin_wheel.png" id="spinButton" onclick="spinWheel()" alt="é–‹å§‹è½‰ç›¤" title="é–‹å§‹è½‰ç›¤">
		
		      </div>
        <br><br>
		
        <div class="damage-input-container">
            <label for="damageInput">è¼¸å…¥å‚·å®³æ•¸å­—ï¼š</label>
            <input type="number" id="damageInput" min="1" value="0">
            <img src="images/Fire.png" id="attackButton" onclick="applyDamage()" alt="æ”»æ“Š" title="æ”»æ“Š">
        </div>
		
		<br>
		<!-- æŠ€èƒ½æŒ‰éˆ• -->
		 <button id="skillButton" onclick="activateSkill()">æŠ€èƒ½: å¿«é€Ÿé»æ“Š (5ç§’)</button>
		 
    </div>

    <div id="lootArea">
        <h2>æ‰è½ç‰©</h2>
        <div class="loot-container" id="lootContainer"></div>
        <button onclick="restartGame()">è¿”å›é¸æ“‡æ€ªç‰©</button>
    </div>

<script>
    let currentMonsterHp = 0;
    let maxHp = 0;
    let drops = [];
    let deadImage = "";
	let hitSound = new Audio();
    let deadSound = new Audio();
    let spinSound = new Audio("sounds/spin_result.mp3");
	let clickCount = 0;
    let skillActive = false;
    let skillTimer;
	let spinCount = 0; // è½‰ç›¤æ¬¡æ•¸
    let skillCooldown = 5; // æŠ€èƒ½å†·å»æ‰€éœ€çš„è½‰ç›¤æ¬¡æ•¸



  document.querySelectorAll(".monster").forEach(monster => {
    monster.addEventListener("click", function() {
        let hp = parseInt(this.dataset.hp);
        let img = this.dataset.img;  // æ´»è‘—çš„æ€ªç‰©åœ–
        let monsterIndex = [...this.parentElement.children].indexOf(this) + 1;

        deadImage = this.dataset.dead; // æ­»äº¡åœ–
        drops = this.dataset.drop.split(",");
        currentMonsterHp = hp;
        maxHp = hp;

        hitSound.src = `sounds/hit${monsterIndex}.mp3`;
        deadSound.src = `sounds/dead${monsterIndex}.mp3`;

        document.getElementById("monsterHp").textContent = hp;
        document.getElementById("damageTaken").textContent = "";
        document.getElementById("healthBar").style.width = "100%";
        document.getElementById("monsterImage").src = img;
        document.getElementById("monsterSelection").style.display = "none";
        document.getElementById("gameArea").style.display = "block";
        document.getElementById("lootArea").style.display = "none";
		document.getElementById("monsterImage").src = img; // ç¢ºä¿é¸æ“‡æ€ªç‰©æ™‚é¡¯ç¤ºæ­£ç¢ºçš„åœ–ç‰‡
		
		// éš±è—é¸æ“‡ GIF
        document.getElementById("selectionGif").style.display = "none";
    });
});

function activateSkill() {
    if (skillActive || spinCount < skillCooldown) return; // è‹¥æŠ€èƒ½å†·å»å‰‡ç„¡æ³•ä½¿ç”¨

    skillActive = true;
    clickCount = 0;
    spinCount = 0; // **æŠ€èƒ½å†·å»é‡ç½®**
    updateSkillButton();
    
    document.getElementById("skillButton").textContent = "ğŸ”¥ å¿«é€Ÿé»æ“Šä¸­! ğŸ”¥";
    document.getElementById("gameArea").addEventListener("click", countClicks);

    skillTimer = setTimeout(() => {
        document.getElementById("gameArea").removeEventListener("click", countClicks);
        document.getElementById("skillButton").textContent = `æŠ€èƒ½å†·å»ä¸­ (${skillCooldown} æ¬¡è½‰ç›¤)`;
        skillActive = false;
        updateSkillButton();
    }, 5000);
}

function countClicks() {
    if (skillActive) {
        clickCount++;

        // **ç«‹å³æ‰£è¡€**
        modifyHp(-1);

        // **æ›´æ–° UI**
        document.getElementById("damageTaken").textContent = `ç¸½å‚·å®³: ${clickCount}`;

        // **æ’­æ”¾å—æ“ŠéŸ³æ•ˆ**
        hitSound.currentTime = 0;
        hitSound.play();
    }
}

function modifyHp(amount) {
    console.log("âš¡ modifyHp() è¢«å‘¼å«ï¼Œå‚·å®³å€¼:", amount);

    let damageContainer = document.getElementById("damageContainer");
    if (!damageContainer) {
        console.error("âŒ Error: damageContainer ä¸å­˜åœ¨ï¼");
        return;
    }

    // **æ›´æ–°è¡€é‡**
    currentMonsterHp = Math.max(0, Math.min(currentMonsterHp + amount, maxHp));
    document.getElementById("monsterHp").textContent = currentMonsterHp;
    document.getElementById("healthBar").style.width = (currentMonsterHp / maxHp * 100) + "%";

    // **ğŸ›‘ é€™è£¡å…ˆæª¢æŸ¥æ€ªç‰©æ˜¯å¦æ­»äº¡**
   if (currentMonsterHp <= 0) {
    let monsterImage = document.getElementById("monsterImage");

    // æ‰¾åˆ°ç•¶å‰æ€ªç‰©çš„ `data-dead` åœ–ç‰‡
    let selectedMonster = document.querySelector(`.monster[data-img="${monsterImage.getAttribute("src")}"]`);
    
    if (selectedMonster) {
        let deadImg = selectedMonster.getAttribute("data-dead"); // å–å¾—æ­»äº¡åœ–ç‰‡
        console.log("ğŸ’€ è®Šæ›´ç‚ºæ­»äº¡åœ–ç‰‡:", deadImg);
        monsterImage.src = deadImg;
    } else {
        console.error("âŒ ç„¡æ³•æ‰¾åˆ°å°æ‡‰çš„æ­»äº¡åœ–ç‰‡ï¼å˜—è©¦ç›´æ¥ä½¿ç”¨ currentMonsterType");
        monsterImage.src = `images/monster${currentMonsterType}_dead.png`;
    }

    // ç¢ºä¿åœ–ç‰‡é¡¯ç¤ºè®Šæ›´
    monsterImage.style.opacity = "1";

    // æ’­æ”¾æ­»äº¡éŸ³æ•ˆ
    deadSound.play();

        // **3ç§’å¾Œé€²å…¥æ‰è½ç‰©çµç®—**
        setTimeout(() => {
            document.getElementById("gameArea").style.display = "none";
            document.getElementById("lootArea").style.display = "block";

            let lootCount = Math.floor(Math.random() * 3) + 1; // éš¨æ©Ÿæ‰è½1~3å€‹
            document.getElementById("lootContainer").innerHTML = Array.from({ length: lootCount }, () => 
                `<img src='images/${drops[Math.floor(Math.random() * drops.length)]}'>`
            ).join('');
        }, 3000);
        
        return; // **æ€ªç‰©æ­»äº†ï¼Œå°±ä¸éœ€è¦ç¹¼çºŒåŸ·è¡Œå‚·å®³å‹•ç•«**
    }

    // **å‚·å®³å‹•ç•« & éœ‡å‹•æ•ˆæœ**
    if (amount !== 0) {
        let damageText = document.createElement("div");
        damageText.classList.add("damage-number");
        damageText.textContent = Math.abs(amount);

        if (amount < 0) {
            hitSound.currentTime = 0;
            hitSound.play();
            shakeMonster(Math.abs(amount)); // éœ‡å‹•æ•ˆæœ
        }

        let monsterImage = document.getElementById("monsterImage");
        let monsterRect = monsterImage.getBoundingClientRect();
        let containerRect = damageContainer.getBoundingClientRect();

        let startX = monsterRect.left + monsterRect.width / 2 - containerRect.left;
        let startY = monsterRect.top + monsterRect.height / 3 - containerRect.top;

        damageText.style.left = `${startX}px`;
        damageText.style.top = `${startY}px`;

        damageContainer.appendChild(damageText);

        let randomAngle = Math.random() * 2 * Math.PI;
        let distance = Math.random() * 80 + 40;
        let offsetX = Math.cos(randomAngle) * distance;
        let offsetY = Math.sin(randomAngle) * distance;

        setTimeout(() => {
            damageText.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(1.5)`;
            damageText.style.opacity = "0";
        }, 10);

        setTimeout(() => {
            damageText.remove();
        }, 1500);
    }
}


    

// **ğŸŒ€ éœ‡å‹•æ•ˆæœ**
function shakeMonster(damage) {
    let monsterImage = document.getElementById("monsterImage");
	
    let intensity = Math.max(3, Math.min(5, damage / 10));
	// ğŸ“Œ ç¢ºä¿æœ€å°éœ‡å‹•å¹…åº¦ç‚º 3pxï¼Œå³ä½¿åªæœ‰ -1 HP
    // ğŸ“Œ å‚·å®³è¶Šå¤§ï¼Œéœ‡å‹•è¶Šå¼·ï¼ˆæœ€å¤§ 5pxï¼‰
    let duration = 300; // éœ‡å‹•æ™‚é–“

    monsterImage.style.transition = "transform 0.05s";
    let frames = [
        { transform: `translate(${intensity}px, 0px)` },
        { transform: `translate(-${intensity}px, 0px)` },
        { transform: `translate(${intensity}px, 0px)` },
        { transform: `translate(-${intensity}px, 0px)` },
        { transform: `translate(0px, 0px)` }
    ];

    monsterImage.animate(frames, { duration: duration, iterations: 1 });
}



function spinWheel() {
    let effects = [
        { text: '<img src="images/dice.png" class="icon"> +1', effect: () => modifyHp(0) },
        { text: '<img src="images/dice.png" class="icon"> -1', effect: () => modifyHp(0) },
        { text: '<img src="images/damage_x2.png" class="icon">', effect: () => applyDamageMultiplier(2) },
        { text: '<img src="images/damage_half.png" class="icon">', effect: () => applyDamageMultiplier(0.5) },
        { text: '<img src="images/heart.png" class="icon"> +5', effect: () => modifyHp(5) },
        { text: '<img src="images/heart.png" class="icon"> +10', effect: () => modifyHp(10) },
        { text: '<img src="images/heart.png" class="icon"> +20', effect: () => modifyHp(20) },
        { text: '<img src="images/heart.png" class="icon"> -5', effect: () => modifyHp(-5) },
        { text: '<img src="images/heart.png" class="icon"> -10', effect: () => modifyHp(-10) },
        { text: '<img src="images/heart.png" class="icon"> -20', effect: () => modifyHp(-20) }
    ];

    let spinResult = document.getElementById("spinResult");
    let intervalTime = 100; 
    let duration = 3000; 
    let elapsedTime = 0;

    let interval = setInterval(() => {
        let randomEffect = effects[Math.floor(Math.random() * effects.length)];
        spinResult.innerHTML = ` ${randomEffect.text}`;
        elapsedTime += intervalTime;

        if (elapsedTime >= duration) {
            clearInterval(interval);
            let chosenEffect = effects[Math.floor(Math.random() * effects.length)];
            spinResult.innerHTML = ` ${chosenEffect.text}`;

            spinSound.play();
            if (chosenEffect.effect) chosenEffect.effect();
        }
    }, intervalTime);
}

// ç¢ºä¿ applyDamageMultiplier() å­˜åœ¨
function applyDamageMultiplier(multiplier) {
    let damage = parseInt(document.getElementById("damageInput").value) || 0;
    modifyHp(-damage * multiplier);
}


function updateSkillButton() {
    let skillButton = document.getElementById("skillButton");
    
    if (spinCount < skillCooldown) {
        skillButton.textContent = `æŠ€èƒ½å†·å»ä¸­ (${skillCooldown - spinCount} æ¬¡è½‰ç›¤)`;
        skillButton.disabled = true;
        skillButton.style.opacity = "0.5"; // æŒ‰éˆ•è®Šç°
    } else {
        skillButton.textContent = "ğŸ”¥ æŠ€èƒ½: å¿«é€Ÿé»æ“Š (5ç§’) ğŸ”¥";
        skillButton.disabled = false;
        skillButton.style.opacity = "1"; // æ¢å¾©æŒ‰éˆ•
    }
}

// **åœ¨é¸æ“‡æ€ªç‰©æ™‚é‡ç½®æŠ€èƒ½å†·å»**
document.querySelectorAll(".monster").forEach(monster => {
    monster.addEventListener("click", function() {
        // è®“æŠ€èƒ½å¯ç”¨
        spinCount = skillCooldown; // **ç¢ºä¿é–‹å ´å¯ä»¥ä½¿ç”¨æŠ€èƒ½**
        updateSkillButton();
    });
});

    function applyDamage() {
        let damage = parseInt(document.getElementById("damageInput").value) || 0;
        modifyHp(-damage);
    }

  
	

    function restartGame() {
        document.getElementById("gameArea").style.display = "none";
        document.getElementById("lootArea").style.display = "none";
        document.getElementById("monsterSelection").style.display = "block";
    }
</script>
</body>
</html>
