<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½‰ç›¤æ‰“æ€ªå°éŠæˆ²</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            color: white;
            background: url('images/background.jpg') no-repeat center center fixed;
            background-size: cover;
        }
        
		    #selectionGif {
                          text-align: center;
                          margin-bottom: 20px;
                          }

            #selectionGif img {
                          width: 300px; /* å¯æ ¹æ“šéœ€æ±‚èª¿æ•´å¤§å° */
                          height: auto;
                          border-radius: 10px;
                              }

        .monster { 
            margin: 10px; padding: 10px; border: 2px solid white; cursor: pointer; display: inline-block; 
            background: rgba(0, 0, 0, 0.5); 
        }

        .spin-result {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 24px;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 20px;
            position: relative;
            min-width: 150px;
        }

        #gameArea, #lootArea { display: none; }

        img { width: 200px; display: block; margin: 0 auto; }

        .health-bar-container {
            width: 300px;
            background-color: #333;
            border-radius: 10px;
            margin: 10px auto;
            overflow: hidden;
            border: 2px solid white;
        }

        .health-bar {
            height: 20px;
            background-color: red;
            transition: width 0.5s ease-in-out;
        }

        #damageTaken {
            display: block;
            margin-top: 10px;
            font-size: 20px;
            color: yellow;
        }

        .damage-input-container {
            margin-top: 20px;
        }
		#skillButton {
                     font-size: 24px;
                     padding: 15px 30px;
                     margin-top: 20px;
                     background-color: orangered;
                     color: white;
                     border: none;
                     border-radius: 10px;
                     cursor: pointer;
                     display: block;
                     width: 80%;
                     max-width: 400px;
                     margin: 20px auto;
                     }

        #skillButton:active {
                     background-color: darkred;
                            }
	#attackButton {

    width: 100px; /* èª¿æ•´å¤§å° */
    height: auto;
    cursor: pointer; /* è®“æ»‘é¼ è®Šæˆé»æ“Šæ‰‹å‹¢ */
    transition: transform 0.1s ease-in-out;
}

#attackButton:active {
    transform: scale(0.9); /* é»æ“Šæ™‚ç¸®å°ä¸€é»ï¼Œå¢åŠ æ‰“æ“Šæ„Ÿ */
}

#spinButton {
    width: 120px; /* èª¿æ•´å¤§å° */
    height: auto;
    cursor: pointer; /* è®“æ»‘é¼ è®Šæˆé»æ“Šæ‰‹å‹¢ */
    transition: transform 0.1s ease-in-out;
}

#spinButton:active {
    transform: scale(0.9); /* é»æ“Šæ™‚ç¸®å°ä¸€é»ï¼Œå¢åŠ æ‰‹æ„Ÿ */
}

.icon {
    width: 30px;  /* èª¿æ•´å¤§å° */
    height: auto;
    vertical-align: middle;  /* è®“åœ–ç‰‡è·Ÿæ–‡å­—å°é½Š */
}

.spin-result {
    width: 200px; /* å›ºå®šå¤§å° */
    height: 50px; /* å›ºå®šé«˜åº¦ */
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 8px;
    font-size: 24px;
    font-weight: bold;
    color: white;
}

.spin-result img {
    max-width: 40px; /* é™åˆ¶åœ–ç‰‡å¤§å° */
    max-height: 40px;
    vertical-align: middle; /* åœ–ç‰‡å‚ç›´ç½®ä¸­ */
}
.spin-container {
    display: flex;
    align-items: center;  /* å‚ç›´ç½®ä¸­ */
    justify-content: center; /* æ°´å¹³ç½®ä¸­ */
    gap: 20px; /* æ§åˆ¶é–“è· */
    margin-top: 20px;

     width: fit-content; /* è®“å®¹å™¨å¯¬åº¦å‰›å¥½é©æ‡‰å…§å®¹ */
    margin: 0 auto; /* è®“å®ƒæ°´å¹³ç½®ä¸­ */
}
#spinButton img {
    width: 80px;  /* æŒ‰éˆ•åœ–ç‰‡å¤§å° */
    height: auto;
    cursor: pointer;
}

.monster-container {
    width: 250px;  /* å›ºå®šæ€ªç‰©é¡¯ç¤ºæ¡†çš„å¯¬åº¦ */
    height: 250px; /* å›ºå®šé«˜åº¦ï¼Œç¢ºä¿åœ–ç‰‡ä¸å½±éŸ¿ç‰ˆé¢ */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* é¿å…æº¢å‡º */
    margin: 0 auto; /* è®“å®ƒç½®ä¸­ */
}

#monsterImage {
    width: 200px; /* è¨­å®šå›ºå®šå¯¬åº¦ */
    height: 200px; /* è¨­å®šå›ºå®šé«˜åº¦ï¼Œç¢ºä¿ä¸è®Šå½¢ */
    object-fit: contain; /* ç¢ºä¿åœ–ç‰‡å®Œæ•´é¡¯ç¤ºï¼Œä¸æ‹‰ä¼¸è®Šå½¢ */
	z-index: 10; /* æ¯”å‚·å®³æ•¸å­—ä½ */
}

#damageTaken {
    display: inline-block;
    width: 100px;  /* å›ºå®šå¯¬åº¦ï¼Œæ ¹æ“šæœ€å¤§å‚·å®³æ•¸å­—èª¿æ•´ */
    text-align: center; /* ç¢ºä¿æ•¸å­—å±…ä¸­ */
    font-size: 20px;
    color: yellow;
}

#damageContainer {
    position: relative;
    width: 100%;
    height: 0;
	z-index: 1000; /* å¿…é ˆé«˜æ–¼æ€ªç‰© */
}

.damage-number {
    position: absolute;
    font-size: 28px;
    font-weight: bold;
    color: yellow;
    opacity: 1;
    transform: scale(1);
    transition: transform 1s ease-out, opacity 1s ease-out;
    white-space: nowrap;
    pointer-events: none;
	z-index: 9999; /* æé«˜å±¤ç´š */
}

.damage-number.animate {
    opacity: 1;
    transform: scale(1.5);
    top: -30px;  /* è®“æ•¸å­—å¾€ä¸Šç§»å‹• */
}

#inventory {
    position: fixed;
    bottom: 10px; /* è·é›¢ç•«é¢åº•éƒ¨ 10px */
    left: 50%;
    transform: translateX(-50%); /* æ°´å¹³ç½®ä¸­ */
    display: flex;
    gap: 5px;
    padding: 10px;
    background: rgba(0, 0, 0, 0.8);
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

#inventorySlots {
    display: flex;
    justify-content: center; /* æ°´å¹³ç½®ä¸­ */
    align-items: center; /* å‚ç›´ç½®ä¸­ï¼ˆå¦‚æœæœ‰é«˜åº¦é™åˆ¶ï¼‰ */
    gap: 5px;
}

.inventory-slot {
     width: 50px;
    height: 50px;
    background-size: cover;
    background-position: center;
    border: 2px solid white;
    position: relative; /* è®“ z-index ç”Ÿæ•ˆ */
    z-index: 10; /* ç¢ºä¿ä¸è¢«å…¶ä»–å…ƒç´ è¦†è“‹ */
}

#itemGrid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 5px;
    width: 290px;
    height: auto;
    padding: 10px;
    background-color: rgba(0, 0, 0, 0.5);
    border: 2px solid white;

    /* ä¸­é–“åä¸‹ä½ç½® */
    margin: 20px auto 40px auto; /* ä¸Šã€å·¦å³ã€ä¸‹ */
}

.item {
    width: 50px;
    height: 50px;
    background-size: cover;
    background-position: center;
    cursor: pointer;
    border: 2px solid white; /* æ¯å€‹é“å…·æ ¼å­åŠ é‚Šæ¡† */
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(255, 255, 255, 0.2);
}

.item:hover {
    background-color: #ddd;
}

#questPanel {
  position: fixed;
  top: 100px;
  right: 20px;
  width: 180px;
  padding: 10px;
  color: #fff;
  z-index: 999;
  text-align: center;
  
  /* ä½¿ç”¨è¼ƒå¤§çš„è™›æ“¬å¯¬é«˜(å¦‚ 180x500)ï¼Œä¸¦ç”¨ background-size: 100% 100% */
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='500'%3E%3Crect width='180' height='500' fill='%23a0522d'/%3E%3Crect x='5' y='5' width='170' height='490' fill='%23deb887' stroke='%23654321' stroke-width='3'/%3E%3C/svg%3E");
  background-size: 100% 100%; /* è®“èƒŒæ™¯è‡ªå‹•æ’æ»¿å®¹å™¨ */
  background-repeat: no-repeat;
  image-rendering: pixelated;
  border-radius: 8px;
  box-sizing: border-box;
}

.quest-item {
  border: 1px solid #ccc;
  background: rgba(255, 255, 255, 0.1);
  margin-bottom: 10px;
  padding: 5px;
  border-radius: 5px;
  justify-content: center;  /* é€™è¡Œè®“å…§å®¹ç½®ä¸­ */
  width: 100%;              /* æ’æ»¿ #questPanel çš„å¯¬åº¦ */
  align-items: center;      /* å‚ç›´ç½®ä¸­ */
}

#questList {
  text-align: center;
}

.quest-title {
  font-weight: bold;
}
.quest-complete {
  color: gold;
  font-weight: bold;
}

.emerald-icon {
  vertical-align: middle;
  height: 40px;
  width: auto;
  object-fit: contain;
}

.quest-monster-icon {
  width: 60px;    /* èª¿æ•´æˆä½ æƒ³è¦çš„å¤§å° */
  height: auto;
  margin-right: 15px;
  text-align: center;
}

.quest-progress {
  font-family: "Microsoft JhengHei", sans-serif;
  color: #fff;
}
.quest-complete {
  color: gold;
  font-weight: bold;
}


  
  


    </style>
</head>
<body>
    <h1>é¸æ“‡æ€ªç‰©</h1>
	
	 <!-- åŠ å…¥ GIF å‹•ç•« -->
    <div id="selectionGif">
        <img src="images/selection.gif" alt="é¸æ“‡æ€ªç‰©å‹•ç•«">
    </div>
	
    <div id="monsterSelection">
    <div class="monster" data-monster="monster1" data-hp="50" data-img="images/monster1.png" data-dead="images/monster1_dead.png" data-drop="emerald.png">æ€ªç‰©A (50HP)</div>
    <div class="monster" data-monster="monster2" data-hp="100" data-img="images/monster2.png" data-dead="images/monster2_dead.png" data-drop="emerald.png">æ€ªç‰©B (100HP)</div>
    <div class="monster" data-monster="monster3" data-hp="150" data-img="images/monster3.png" data-dead="images/monster3_dead.png" data-drop="emerald.png">æ€ªç‰©C (150HP)</div>
    <div class="monster" data-monster="monster4" data-hp="200" data-img="images/monster4.png" data-dead="images/monster4_dead.png" data-drop="helmet.png">æ€ªç‰©D (200HP)</div>
</div>

	
	<div id="questPanel">
  <h2>ç‹©çµä»»å‹™</h2>
  <div id="questList"></div>
</div>
	
	<div id="emeraldDisplay" style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: lime; padding: 5px 10px; border-radius: 5px; font-family: 'Microsoft JhengHei', sans-serif;">
  Emerald: 0
</div>

	<div id="menu">
    <h2>é¸æ“‡é“å…·</h2>
    
    <!-- é“å…·æ¬„ï¼ˆæœ€å¤š 10 å€‹ï¼‰ -->
    <div id="inventory">
        <h3>ğŸ“¦ é“å…·æ¬„</h3>
        <div id="inventorySlots">
            <!-- é€™è£¡æœƒå‹•æ…‹å¡«å……é“å…· -->
        </div>
    </div>

    <!-- é“å…·é¸æ“‡å€ -->
    <div id="itemSelection">
        <h3>ğŸ’ é“å…·é¸æ“‡</h3>
        <div id="itemGrid">
            <!-- é€™è£¡æœƒå‹•æ…‹å¡«å…… 5x5 çš„é“å…· -->
        </div>
    </div>
    </div>

    <div id="gameArea">

        <h2>æ€ªç‰©è¡€é‡: <span id="monsterHp"></span></h2>
        <div class="health-bar-container">
            <div id="healthBar" class="health-bar"></div>
        </div>
	<div id="damageContainer" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div>
	
	<div id="monsterContainer" style="position: relative; display: inline-block;">
    <img id="monsterImage" src="monster_alive.png">
   
</div>
        <p id="damageTaken"></p>
		<div class="spin-container">
		
              <div id="spinResult" class="spin-result"></div>
			  
		<!-- è½‰ç›¤æŒ‰éˆ• --> 
        <img src="images/spin_wheel.png" id="spinButton" onclick="spinWheel()" alt="é–‹å§‹è½‰ç›¤" title="é–‹å§‹è½‰ç›¤">
		
		      </div>
        <br><br>
		
        <div class="damage-input-container">
            <label for="damageInput">è¼¸å…¥å‚·å®³æ•¸å­—ï¼š</label>
            <input type="number" id="damageInput" min="1" value="0">
            <img src="images/Fire.png" id="attackButton" onclick="applyDamage()" alt="æ”»æ“Š" title="æ”»æ“Š">
        </div>
		
		<br>
		<!-- æŠ€èƒ½æŒ‰éˆ• -->
		 <button id="skillButton" onclick="activateSkill()">æŠ€èƒ½: å¿«é€Ÿé»æ“Š (5ç§’)</button>
		 
    </div>

    <div id="lootArea">
        <h2>æ‰è½ç‰©</h2>
        <div class="loot-container" id="lootContainer"></div>
        <button onclick="restartGame()">è¿”å›é¸æ“‡æ€ªç‰©</button>
    </div>

<script>
// â”€â”€ å…¨åŸŸè®Šæ•¸å®£å‘Š â”€â”€
let currentMonsterHp = 0;
let maxHp = 0;
let drops = [];
let deadImage = "";
let hitSound = new Audio();
let deadSound = new Audio();
let spinSound = new Audio("sounds/spin_result.mp3");
let clickCount = 0;
let skillActive = false;
let skillTimer;
let spinCount = 0; // è½‰ç›¤æ¬¡æ•¸
let skillCooldown = 5; // æŠ€èƒ½å†·å»æ‰€éœ€è½‰ç›¤æ¬¡æ•¸

// æ–°å¢å…¨åŸŸè®Šæ•¸ä¾†è¨˜éŒ„ç›®å‰æˆ°é¬¥çš„æ€ªç‰©é¡å‹
let currentMonsterType = "";

window.onload = function() {
  initializeQuests();
  updateEmeraldDisplay();
  // ...å…¶ä»–åˆå§‹åŒ–å‹•ä½œ
};

// â”€â”€ æ€ªç‰©é»æ“Šäº‹ä»¶ â”€â”€
document.querySelectorAll(".monster").forEach(monster => {
    monster.addEventListener("click", function() {
        let hp = parseInt(this.dataset.hp);
        let img = this.dataset.img; // æ´»è‘—çš„æ€ªç‰©åœ–
        let monsterIndex = [...this.parentElement.children].indexOf(this) + 1;

        deadImage = this.dataset.dead; // æ­»äº¡åœ–
        drops = this.dataset.drop.split(",");
        currentMonsterHp = hp;
        maxHp = hp;
        
        // å„²å­˜ç›®å‰æ€ªç‰©é¡å‹ï¼Œè«‹ç¢ºä¿ä½ çš„ HTML å…§æœ‰ data-monster å±¬æ€§
        currentMonsterType = this.dataset.monster;

        hitSound.src = `sounds/hit${monsterIndex}.mp3`;
        deadSound.src = `sounds/dead${monsterIndex}.mp3`;

        document.getElementById("monsterHp").textContent = hp;
        document.getElementById("damageTaken").textContent = "";
        document.getElementById("healthBar").style.width = "100%";
        document.getElementById("monsterImage").src = img;
        document.getElementById("monsterSelection").style.display = "none";
        document.getElementById("gameArea").style.display = "block";
        document.getElementById("lootArea").style.display = "none";
        document.getElementById("itemSelection").style.display = "none";
        document.getElementById("selectionGif").style.display = "none";

        // é‡ç½®æŠ€èƒ½å†·å»ï¼šé–‹å ´å³å¯ä½¿ç”¨æŠ€èƒ½
        spinCount = skillCooldown;
        updateSkillButton();
    });
});

    // â”€â”€ å–å¾— DOM â”€â”€
    const inventorySlots = document.getElementById("inventorySlots");
    const itemGrid = document.getElementById("itemGrid");

    const items = [
        "item1.png", "item2.png", "item3.png", "item4.png", "arrow.png",
        "elixir.png", "bomb.png", "fireball.png", "ice_crystal.png", "thunder_scroll.png",
        "hp_up.png", "attack_up.png", "defense_up.png", "speed_boost.png", "revive.png"
    ];

    // ç”Ÿæˆé“å…·æ¬„ï¼ˆ10æ ¼ï¼‰
    for (let i = 0; i < 10; i++) {
        let slot = document.createElement("div");
        slot.classList.add("inventory-slot");
        slot.dataset.index = i;
        inventorySlots.appendChild(slot);
    }

    // é»æ“Šé“å…·æ¬„æ ¼å­ï¼šç¢ºèªå¾Œç§»é™¤é“å…·
    document.querySelectorAll(".inventory-slot").forEach(slot => {
        slot.addEventListener("click", function () {
            if (slot.classList.contains("filled") && confirm("ç¢ºå®šè¦ç§»é™¤é€™å€‹é“å…·å—ï¼Ÿ")) {
                slot.style.backgroundImage = "";
                slot.classList.remove("filled");
                delete slot.dataset.item;
            }
        });
    });

    // ç”Ÿæˆé“å…·é¸æ“‡å€ï¼ˆ5x5ï¼‰
    items.forEach(item => {
    let itemElement = document.createElement("div");
    itemElement.classList.add("item");
    itemElement.dataset.item = item.replace(".png", "");
    itemElement.style.backgroundImage = `url(images/${item})`;

    // é»æ“Šé“å…·å¾ŒåŠ å…¥é“å…·æ¬„çš„ç¬¬ä¸€å€‹ç©ºæ ¼
    itemElement.addEventListener("click", function () {
        let itemName = item.replace(".png", "");

        // æª¢æŸ¥æ˜¯å¦ item3ï¼Œéœ€è¦æ¶ˆè€— 1 é¡† emerald
        if (itemName === "item3") {
            if (emeraldCount < 1) {
                alert("éœ€è¦ä¸€é¡†ç¶ å¯¶çŸ³ï¼");
                return;
            } else {
                // æ¶ˆè€— 1 é¡† emerald
                emeraldCount -= 1;
                updateEmeraldDisplay(); // æ›´æ–°å³ä¸‹è§’é¡¯ç¤º
            }
        }

        // å°‹æ‰¾ç¬¬ä¸€å€‹ç©ºæ ¼ï¼Œæ”¾å…¥é“å…·
        let emptySlot = document.querySelector(".inventory-slot:not(.filled)");
        if (emptySlot) {
            emptySlot.style.backgroundImage = `url(images/${item})`;
            emptySlot.classList.add("filled");
            emptySlot.dataset.item = itemName;
        }
    });

    itemGrid.appendChild(itemElement);
});


    // â”€â”€ ä»»å‹™ç³»çµ±ç›¸é—œ â”€â”€

    // å…¨éƒ¨å¯èƒ½çš„ä»»å‹™å®šç¾©ï¼ˆå››ç¨®ä»»å‹™ï¼‰
    const ALL_QUESTS = [
      {
        id: 1,
        monster: "monster1",  // å°æ‡‰ monster1.png
        minCount: 1,
        maxCount: 3,
        rewardName: "emerald",
        rewardAmount: 2
      },
      {
        id: 2,
        monster: "monster2",  // å°æ‡‰ monster2.png
        minCount: 1,
        maxCount: 3,
        rewardName: "emerald",
        rewardAmount: 3
      },
      {
        id: 3,
        monster: "monster3",  // å°æ‡‰ monster3.png
        minCount: 1,
        maxCount: 2,
        rewardName: "emerald",
        rewardAmount: 4
      },
      {
        id: 4,
        monster: "monster4",  // å°æ‡‰ monster4.png
        minCount: 1,
        maxCount: 1,
        rewardName: "emerald",
        rewardAmount: 5
      }
    ];

    // ç•¶å‰é€²è¡Œä¸­çš„ä»»å‹™åˆ—è¡¨
    let activeQuests = [];

    // ç”¨ä¾†è¨˜éŒ„ç©å®¶æŒæœ‰çš„ emerald æ•¸é‡
    let emeraldCount = 0;

    // åˆå§‹åŒ–ä»»å‹™ï¼Œéš¨æ©Ÿæ±ºå®šæ¯å€‹ä»»å‹™éœ€æ±‚æ•¸é‡ï¼Œä¸¦æ›´æ–°å³ä¸Šä»»å‹™é¢æ¿
    function initializeQuests() {
      activeQuests = ALL_QUESTS.map(q => {
        const required = Math.floor(Math.random() * (q.maxCount - q.minCount + 1)) + q.minCount;
        return {
          id: q.id,
          monster: q.monster,
          required: required,
          current: 0,
          isComplete: false,
          rewardName: q.rewardName,
          rewardAmount: q.rewardAmount,
          rewardGiven: false
        };
      });
      renderQuests();
    }

    // æ›´æ–°å³ä¸Šä»»å‹™é¢æ¿ï¼ˆHTML ä¸­éœ€æœ‰ <div id="questList"></div>ï¼‰
    function renderQuests() {
  const questList = document.getElementById("questList");
  if (!questList) return;
  
  questList.innerHTML = "";
  activeQuests.forEach(q => {
    // å»ºç«‹ä»»å‹™é …ç›®å®¹å™¨
    const questItem = document.createElement("div");
    questItem.classList.add("quest-item");
    
    // å»ºç«‹æ€ªç‰©åœ–ç‰‡ï¼ˆä¾æ“š q.monsterï¼Œä¾‹å¦‚ "monster1"ï¼‰
    const monsterImg = document.createElement("img");
    monsterImg.src = `images/${q.monster}.png`;
    monsterImg.alt = q.monster;
    monsterImg.classList.add("quest-monster-icon");
    
    // å»ºç«‹é€²åº¦æ•¸å­—ï¼Œè‹¥ä»»å‹™å®Œæˆå‰‡é¡¯ç¤ºå·²å®Œæˆ
    const progress = document.createElement("div");
    progress.classList.add("quest-progress");
    if (q.isComplete) {
      progress.innerHTML = `<span class="quest-complete">å·²å®Œæˆ</span>`;
    } else {
      progress.innerHTML = `<span>${q.current}</span> / <span>${q.required}</span>`;
    }
    
    // å°‡åœ–ç‰‡å’Œé€²åº¦æ”¾å…¥ä»»å‹™é …ç›®ä¸­
    questItem.appendChild(monsterImg);
    questItem.appendChild(progress);
    questList.appendChild(questItem);
  });
}

    // æ ¹æ“šæ“Šæ•—çš„æ€ªç‰©æ›´æ–°ä»»å‹™é€²åº¦
    function updateQuestProgress(monsterType) {
      activeQuests.forEach(q => {
        if (!q.isComplete && q.monster === monsterType) {
          q.current++;
          if (q.current >= q.required) {
            q.isComplete = true;
            console.log(`ä»»å‹™å®Œæˆï¼ç‹©çµæ€ªç‰© ${q.monster}`);
          }
        }
      });
      renderQuests();
    }

    // â”€â”€ æˆ°é¬¥ç›¸é—œå‡½å¼ â”€â”€

    // é–‹å§‹æˆ°é¬¥ï¼šåˆ‡æ› UI ä¸¦æ›´æ–°ä»»å‹™é¢æ¿
    function startBattle() {
        document.getElementById("gameArea").style.display = "block";
        document.getElementById("monsterSelection").style.display = "none";
        document.getElementById("lootArea").style.display = "none";
        document.getElementById("inventory").style.display = "flex";
        document.getElementById("itemSelection").style.display = "none";
        // ç¢ºä¿é¡¯ç¤ºä»»å‹™ï¼ˆä»»å‹™åˆå§‹åŒ–å¾Œå°±æœƒé¡¯ç¤ºåœ¨å³ä¸Šï¼‰
        renderQuests();

        equippedItems = [];
        document.querySelectorAll(".inventory-slot").forEach(slot => {
            if (slot.dataset.item) { 
                equippedItems.push(slot.dataset.item);
                console.log(`å·²è£å‚™: ${slot.dataset.item}`);
            }
        });

        updateSkillButton();
    }

    // é‡ç½®é“å…·æ¬„ï¼ˆæ¸…ç©ºæ‰€æœ‰æ ¼å­ï¼‰
    function resetInventory() {
        document.querySelectorAll(".inventory-slot").forEach(slot => {
            slot.style.backgroundImage = "";
            slot.classList.remove("filled");
            delete slot.dataset.item;
        });
    }

    // æŠ€èƒ½ï¼šå¿«é€Ÿé»æ“Š
    function activateSkill() {
        if (skillActive || spinCount < skillCooldown) return;

        skillActive = true;
        clickCount = 0;
        spinCount = 0; // é‡ç½®æŠ€èƒ½å†·å»
        updateSkillButton();
        
        document.getElementById("skillButton").textContent = "ğŸ”¥ å¿«é€Ÿé»æ“Šä¸­! ğŸ”¥";
        document.getElementById("gameArea").addEventListener("click", countClicks);

        skillTimer = setTimeout(() => {
            document.getElementById("gameArea").removeEventListener("click", countClicks);
            document.getElementById("skillButton").textContent = `æŠ€èƒ½å†·å»ä¸­ (${skillCooldown} æ¬¡è½‰ç›¤)`;
            skillActive = false;
            updateSkillButton();
        }, 5000);
    }

    function countClicks() {
        if (skillActive) {
            clickCount++;
            let damage = -1;
            let damageType = "click";

            // 20% æ©Ÿç‡æª¢æŸ¥æŠ€èƒ½å¼·åŒ–é“å…· (item2)
            if (hasItem("item2") && Math.random() < 0.2) {
                console.log("æŠ€èƒ½å¼·åŒ–é“å…·ç”Ÿæ•ˆï¼é»æ“Šå‚·å®³è®Šç‚º 2 é»ï¼");
                damage = -2;
            }
            
            console.log(`é»æ“Šå‚·å®³: ${damage}`);
            modifyHp(damage, damageType);
            document.getElementById("damageTaken").textContent = `ç¸½å‚·å®³: ${clickCount}`;
            hitSound.currentTime = 0;
            hitSound.play();
        }
    }

    // ä¿®æ”¹æ€ªç‰©è¡€é‡ï¼Œä¸¦åŸ·è¡Œå‹•ç•«èˆ‡éŸ³æ•ˆ
    function modifyHp(amount, damageType) {
        console.log(`modifyHp() è¢«å‘¼å«ï¼Œå‚·å®³å€¼: ${amount}, é¡å‹: ${damageType}`);

        const damageContainer = document.getElementById("damageContainer");
        const monsterHpElement = document.getElementById("monsterHp");
        const healthBar = document.getElementById("healthBar");

        if (!damageContainer || !monsterHpElement || !healthBar) {
            console.error("å¿…è¦çš„ UI å…ƒç´ ä¸å­˜åœ¨ï¼");
            return;
        }

        // å¦‚æœæ“æœ‰ item1ï¼Œè½‰ç›¤å‚·å®³ -5/-10/-20 æ™‚é¡å¤– +5 å‚·å®³
        if (damageType === "spin" && hasItem("item1") && [-5, -10, -20].includes(amount)) {
            console.log(`è½‰ç›¤å¼·åŒ–é“å…·ç”Ÿæ•ˆï¼ŒåŸå‚·å®³: ${amount}`);
            amount -= 5;
        }

        currentMonsterHp = Math.max(0, Math.min(currentMonsterHp + amount, maxHp));
        monsterHpElement.textContent = currentMonsterHp;
        healthBar.style.width = `${(currentMonsterHp / maxHp) * 100}%`;

        if (currentMonsterHp <= 0) {
            handleMonsterDeath();
            return;
        }

        if (amount !== 0) displayDamageEffect(amount);
    }

    // æ€ªç‰©æ­»äº¡è™•ç†ï¼šæ›´æ–°ä»»å‹™é€²åº¦ä¸¦æ’­æ”¾æ­»äº¡å‹•ç•«
    // â”€â”€ æ€ªç‰©æ­»äº¡è™•ç† â”€â”€
function handleMonsterDeath() {
    const monsterImage = document.getElementById("monsterImage");
    // ç›´æ¥ä½¿ç”¨å…¨åŸŸè®Šæ•¸ currentMonsterType ä¾†æ›´æ–°ä»»å‹™é€²åº¦
    updateQuestProgress(currentMonsterType);

    // é€é data-img æ‰¾å‡ºé¸æ“‡çš„æ€ªç‰©ä¸¦å–å¾—æ­»äº¡åœ–
    const selectedMonster = document.querySelector(`.monster[data-img="${monsterImage.getAttribute("src")}"]`);
    if (selectedMonster) {
        let deadImg = selectedMonster.getAttribute("data-dead");
        console.log("è®Šæ›´ç‚ºæ­»äº¡åœ–ç‰‡:", deadImg);
        monsterImage.src = deadImg;
    } else {
        console.error("ç„¡æ³•æ‰¾åˆ°å°æ‡‰çš„æ­»äº¡åœ–ç‰‡ï¼");
        monsterImage.src = "images/monster_dead.png";
    }

    monsterImage.style.opacity = "1";
    deadSound.play();

    setTimeout(() => {
        document.getElementById("gameArea").style.display = "none";
        document.getElementById("lootArea").style.display = "block";
        generateLoot();
    }, 3000);
}

    // æ‰è½ç‰©ç”Ÿæˆï¼Œä¸¦æª¢æŸ¥ä»»å‹™å®Œæˆæƒ…æ³ç™¼æ”¾çå‹µ
    function generateLoot() {
    const lootContainer = document.getElementById("lootContainer");
    let lootCount = Math.floor(Math.random() * 3) + 1;
    let lootHTML = "";

    for (let i = 0; i < lootCount; i++) {
        // éš¨æ©Ÿé¸ä¸€å€‹æ‰è½ç‰©
        let randomDrop = drops[Math.floor(Math.random() * drops.length)];
        lootHTML += `<img src="images/${randomDrop}">`;

        // å¦‚æœæ‰è½ç‰©æ˜¯ emeraldï¼ˆä¾‹å¦‚ "emerald.png"ï¼‰ï¼Œå‰‡çµ±è¨ˆ
        if (randomDrop === "emerald.png") {
            emeraldCount++; // æ¯å€‹ emerald æ‰è½è¨ˆ1
        }
    }
    lootContainer.innerHTML = lootHTML;

    // æª¢æŸ¥ä»»å‹™å®Œæˆç‹€æ…‹ï¼Œç™¼æ”¾ä»»å‹™çå‹µ
    activeQuests.forEach(q => {
        if (q.isComplete && !q.rewardGiven) {
            q.rewardGiven = true;
            emeraldCount += q.rewardAmount;
            
            let rewardMsg = document.createElement("div");
            rewardMsg.style.color = "lime";
            rewardMsg.textContent = `çå‹µï¼š${q.rewardName} x${q.rewardAmount}`;
            lootContainer.appendChild(rewardMsg);
            
            console.log(`ç²å¾—ä»»å‹™çå‹µï¼š${q.rewardName} x${q.rewardAmount}ï¼Œç›®å‰ emeraldCount = ${emeraldCount}`);
        }
    });
    
    updateEmeraldDisplay();
}


    // è½‰ç›¤é‚è¼¯
    function spinWheel() {
        let effects;
        if (hasItem("item3")) {
            effects = [
                { text: '<img src="images/heart.png" class="icon"> -5', effect: () => modifyHp(-5, "spin") },
                { text: '<img src="images/heart.png" class="icon"> -10', effect: () => modifyHp(-10, "spin") },
                { text: '<img src="images/heart.png" class="icon"> -20', effect: () => modifyHp(-20, "spin") }
            ];
        } else {
            effects = [
                { text: '<img src="images/dice.png" class="icon"> +1', effect: () => modifyHp(0) },
                { text: '<img src="images/dice.png" class="icon"> -1', effect: () => modifyHp(0) },
                { text: '<img src="images/damage_x2.png" class="icon">', effect: () => applyDamageMultiplier(2) },
                { text: '<img src="images/damage_half.png" class="icon">', effect: () => applyDamageMultiplier(0.5) },
                { text: '<img src="images/heart.png" class="icon"> +5', effect: () => modifyHp(5) },
                { text: '<img src="images/heart.png" class="icon"> +10', effect: () => modifyHp(10) },
                { text: '<img src="images/heart.png" class="icon"> +20', effect: () => modifyHp(20) },
                { text: '<img src="images/heart.png" class="icon"> -5', effect: () => modifyHp(-5, "spin") },
                { text: '<img src="images/heart.png" class="icon"> -10', effect: () => modifyHp(-10, "spin") },
                { text: '<img src="images/heart.png" class="icon"> -20', effect: () => modifyHp(-20, "spin") }
            ];
        }

        let spinResult = document.getElementById("spinResult");
        let intervalTime = 100;
        let duration = 3000;
        let elapsedTime = 0;

        let interval = setInterval(() => {
            let randomEffect = effects[Math.floor(Math.random() * effects.length)];
            spinResult.innerHTML = randomEffect.text;
            elapsedTime += intervalTime;

            if (elapsedTime >= duration) {
                clearInterval(interval);
                let chosenEffect = effects[Math.floor(Math.random() * effects.length)];
                spinResult.innerHTML = chosenEffect.text;
                spinSound.play();
                if (chosenEffect.effect) chosenEffect.effect();
                spinCount++;
                updateSkillButton();

                // åˆ¤å®š item3 é¡å¤–è½‰ç›¤æ•ˆæœåŠæ¶ˆè€—ä¸€å€‹ item3
                if (hasItem("item3") && Math.random() < 0.35) {
                    let slot = document.querySelector(".inventory-slot[data-item='item3']");
                    if (slot) {
                        slot.style.backgroundImage = "";
                        slot.classList.remove("filled");
                        delete slot.dataset.item;
                        console.log("item3 æ¶ˆè€—ä¸€å€‹ï¼Œé¡å¤–è½‰ç›¤");
                    }
                    spinWheel();
                }
            }
        }, intervalTime);
    }

    // å‚·å®³å€ç‡è™•ç†
    function applyDamageMultiplier(multiplier) {
        let damage = parseInt(document.getElementById("damageInput").value) || 0;
        modifyHp(-damage * multiplier);
    }

    // æ›´æ–°æŠ€èƒ½æŒ‰éˆ•ç‹€æ…‹
    function updateSkillButton() {
        let skillButton = document.getElementById("skillButton");
        if (spinCount < skillCooldown) {
            skillButton.textContent = `æŠ€èƒ½å†·å»ä¸­ (${skillCooldown - spinCount} æ¬¡è½‰ç›¤)`;
            skillButton.disabled = true;
            skillButton.style.opacity = "0.5";
        } else {
            skillButton.textContent = "ğŸ”¥ æŠ€èƒ½: å¿«é€Ÿé»æ“Š (5ç§’) ğŸ”¥";
            skillButton.disabled = false;
            skillButton.style.opacity = "1";
        }
    }

    // æ™®é€šæ”»æ“Šï¼šæ ¹æ“šè¼¸å…¥å‚·å®³å€¼æ‰£è¡€ï¼Œä¸¦é‡ç½®è¼¸å…¥æ¡†
    function applyDamage() {
        let damage = parseInt(document.getElementById("damageInput").value) || 0;
        modifyHp(-damage);
        document.getElementById("damageInput").value = 0;
    }

    // å‚·å®³æ•ˆæœå‹•ç•«
    function displayDamageEffect(amount) {
        const damageContainer = document.getElementById("damageContainer");
        const monsterImage = document.getElementById("monsterImage");

        let damageText = document.createElement("div");
        damageText.classList.add("damage-number");
        damageText.textContent = Math.abs(amount);

        if (amount < 0) {
            hitSound.currentTime = 0;
            hitSound.play();
            shakeMonster(Math.abs(amount));
        }

        let monsterRect = monsterImage.getBoundingClientRect();
        let containerRect = damageContainer.getBoundingClientRect();
        let startX = monsterRect.left + monsterRect.width / 2 - containerRect.left;
        let startY = monsterRect.top + monsterRect.height / 3 - containerRect.top;
        
        damageText.style.left = `${startX}px`;
        damageText.style.top = `${startY}px`;
        damageContainer.appendChild(damageText);

        let randomAngle = Math.random() * 2 * Math.PI;
        let distance = Math.random() * 80 + 40;
        let offsetX = Math.cos(randomAngle) * distance;
        let offsetY = Math.sin(randomAngle) * distance;

        setTimeout(() => {
            damageText.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(1.5)`;
            damageText.style.opacity = "0";
        }, 10);

        setTimeout(() => {
            damageText.remove();
        }, 1500);
    }

    // æ€ªç‰©éœ‡å‹•æ•ˆæœ
    function shakeMonster(damage) {
        let monsterImage = document.getElementById("monsterImage");
        let intensity = Math.max(3, Math.min(5, damage / 10));
        let duration = 300;
        monsterImage.style.transition = "transform 0.05s";
        let frames = [
            { transform: `translate(${intensity}px, 0px)` },
            { transform: `translate(-${intensity}px, 0px)` },
            { transform: `translate(${intensity}px, 0px)` },
            { transform: `translate(-${intensity}px, 0px)` },
            { transform: `translate(0px, 0px)` }
        ];
        monsterImage.animate(frames, { duration: duration, iterations: 1 });
    }

    // é‡å•ŸéŠæˆ²ï¼šåƒ…é‡ç½®ç•«é¢èˆ‡éƒ¨ä»½ UIï¼Œä½†ä¿ç•™ä»»å‹™é€²åº¦èˆ‡çå‹µç´¯è¨ˆ
    function restartGame() {
        document.getElementById("gameArea").style.display = "none";
        document.getElementById("lootArea").style.display = "none";
        resetInventory();
        document.getElementById("monsterSelection").style.display = "block";
        document.getElementById("selectionGif").style.display = "block";
        document.getElementById("itemSelection").style.display = "block";
        document.getElementById("damageTaken").textContent = "";
        document.getElementById("healthBar").style.width = "100%";
    }

    // â”€â”€ æª¢æŸ¥æ˜¯å¦æŒæœ‰æŒ‡å®šé“å…· â”€â”€
    function hasItem(itemName) {
        return [...document.querySelectorAll(".inventory-slot")].some(slot => slot.dataset.item === itemName);
    }

    // â”€â”€ åˆå§‹åŒ–ï¼šé é¢è¼‰å…¥æ™‚åŸ·è¡Œ â”€â”€
    window.onload = function() {
      initializeQuests();
      // å…¶ä»–åˆå§‹åŒ–å‹•ä½œâ€¦â€¦
    };
	
	// æ›´æ–°å³ä¸‹è§’ emerald çµ±è¨ˆ
function updateEmeraldDisplay() {
  const emeraldDisplay = document.getElementById("emeraldDisplay");
  if (emeraldDisplay) {
    emeraldDisplay.innerHTML = `
      <img src="images/emerald.png" alt="emerald" class="emerald-icon">
      <span>${emeraldCount}</span>
    `;
  }
}


</script>
</body>
</html>
